<!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=6.4.1" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-fire.png?v=6.4.1"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-fire.png?v=6.4.1"><link rel="mask-icon" href="/images/logo.svg?v=6.4.1" color="#222"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"6.4.1",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="2018年9月25日（美国当地时间），Oracle发布了Java SE 11（18.9）（JSR 384）版本。这是继2014年3月发布Java SE 8之后的首个长期支持版本（LTS），根据后续的发布计划，下一个长期支持版本要到2021年9月才会发布。因此Java SE 11 是一个值得关注和学习的版本。本文将简单介绍该版本引入的新特性，在后续文章中将会对每一个新特性进行详细介绍。"><meta name="keywords" content="IT技术,Java,新特性"><meta property="og:type" content="article"><meta property="og:title" content="Java 11 新特性预览"><meta property="og:url" content="https://snowolf.gitee.io/2018/09/29/1/index.html"><meta property="og:site_name" content="焰冰封"><meta property="og:description" content="2018年9月25日（美国当地时间），Oracle发布了Java SE 11（18.9）（JSR 384）版本。这是继2014年3月发布Java SE 8之后的首个长期支持版本（LTS），根据后续的发布计划，下一个长期支持版本要到2021年9月才会发布。因此Java SE 11 是一个值得关注和学习的版本。本文将简单介绍该版本引入的新特性，在后续文章中将会对每一个新特性进行详细介绍。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://snowolf.gitee.io/images/blog/jdk11_feature_preview/thumb.png"><meta property="og:updated_time" content="2018-09-29T11:15:45.689Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Java 11 新特性预览"><meta name="twitter:description" content="2018年9月25日（美国当地时间），Oracle发布了Java SE 11（18.9）（JSR 384）版本。这是继2014年3月发布Java SE 8之后的首个长期支持版本（LTS），根据后续的发布计划，下一个长期支持版本要到2021年9月才会发布。因此Java SE 11 是一个值得关注和学习的版本。本文将简单介绍该版本引入的新特性，在后续文章中将会对每一个新特性进行详细介绍。"><meta name="twitter:image" content="https://snowolf.gitee.io/images/blog/jdk11_feature_preview/thumb.png"><link rel="alternate" href="/atom.xml" title="焰冰封" type="application/atom+xml"><link rel="canonical" href="https://snowolf.gitee.io/2018/09/29/1/"><script type="text/javascript" id="page.configurations">CONFIG.page={sidebar:""}</script><title>Java 11 新特性预览 | 焰冰封</title><noscript><style type="text/css">.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://gitee.com/snowolf/blog.git" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">焰冰封</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">个人博客</p></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-top"><a href="/top/" rel="section"><i class="menu-item-icon fa fa-fw fa-signal"></i><br>排行榜</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://snowolf.gitee.io/2018/09/29/1/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Snowolf Lee"><meta itemprop="description" content="知行合一  笃行求是"><meta itemprop="image" content="/images/sai.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="焰冰封"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Java 11 新特性预览</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-09-29 12:19:19 / 修改时间：19:15:45" itemprop="dateCreated datePublished" datetime="2018-09-29T12:19:19+08:00">2018-09-29</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/IT技术/" itemprop="url" rel="index"><span itemprop="name">IT技术</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/IT技术/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <a href="/2018/09/29/1/#comments" itemprop="discussionUrl"><span class="post-meta-item-text">评论数：</span><span class="post-comments-count valine-comment-count" data-xid="/2018/09/29/1/" itemprop="commentCount"></span></a></span> <span id="/2018/09/29/1/" class="leancloud_visitors" data-flag-title="Java 11 新特性预览"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span> <span>℃</span></span><div class="post-description">2018年9月25日（美国当地时间），Oracle发布了Java SE 11（18.9）（JSR 384）版本。这是继2014年3月发布Java SE 8之后的首个长期支持版本（LTS），根据后续的发布计划，下一个长期支持版本要到2021年9月才会发布。因此Java SE 11 是一个值得关注和学习的版本。本文将简单介绍该版本引入的新特性，在后续文章中将会对每一个新特性进行详细介绍。</div></div></header><div class="post-body" itemprop="articleBody"><div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery"><div class="post-gallery-row"> <a class="post-gallery-img fancybox" href="/images/blog/jdk11_feature_preview/thumb.png" rel="gallery_cjmncbxnb0002gce6frfa6yxo" itemscope itemtype="http://schema.org/ImageObject" itemprop="url"><img src="/images/blog/jdk11_feature_preview/thumb.png" itemprop="contentUrl"></a></div></div><p>&emsp;&emsp;2018年是Java新版本发布比较频繁的一年，距2018年3月发布 Java 10 版本6个月后，Oracle发布了Java 11(18.9) (<a href="http://cr.openjdk.java.net/~iris/se/11/latestSpec/" target="_blank" rel="noopener">JSR 384</a>)。值得注意的是，和Java 9 和 Java 10 这两个被称为“功能性的版本”不同（两者均只提供半年的技术支持），Java 11 不仅提供了长期支持服务，还将作为 Java 平台的参考实现。Oracle直到2023年9月都会为 Java 11 提供技术支持，而补丁和安全警告等扩展支持将持续到2026年。新的长期支持版本每三年发布一次，根据后续的发布计划，下一个长期支持版 Java 17 将于2021年发布。<br>&emsp;&emsp;Java Development Kit（JDK）11 （<a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk11-downloads-5066655.html" target="_blank" rel="noopener">下载</a>） 不仅仅是一个升级版。 它是 Java 语言的一个大有改善的版本，其中有几个功能专注于性能。 下面将简单介绍其值得关注的一些新特性。</p><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><h3 id="Lambda-参数的本地变量语法"><a href="#Lambda-参数的本地变量语法" class="headerlink" title="Lambda 参数的本地变量语法"></a>Lambda 参数的本地变量语法</h3><p>&emsp;&emsp;Lambda 参数的本地变量语法（<a href="http://openjdk.java.net/jeps/323" target="_blank" rel="noopener">JEP 323: Local-Variable Syntax for Lambda Parameters</a>）：在声明隐式类型的 lambda 表达式的形式参数时允许使用 var。<br>&emsp;&emsp;为了Java代码更加的简介，Java 10 引入了局部变量类型推断的特性，Java 11对该特性进行了增强，它允许在lamdba表达式中，声明隐式类型参数时使用var关键字。这样保证了在Java 代码编写时，参数声明方式的一致性。代码如下所示：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(x, y) -&gt; x.process(y)    <span class="comment">//before Java 11</span></span><br><span class="line">(var x, var y) -&gt; x.process(y)   <span class="comment">//Java 11</span></span><br></pre></td></tr></table></figure><p></p><h2 id="类库"><a href="#类库" class="headerlink" title="类库"></a>类库</h2><h3 id="HTTP-客户端（标准）"><a href="#HTTP-客户端（标准）" class="headerlink" title="HTTP 客户端（标准）"></a>HTTP 客户端（标准）</h3><p>&emsp;&emsp;HTTP 客户端（标准）（<a href="http://openjdk.java.net/jeps/321" target="_blank" rel="noopener">JEP 321: HTTP Client (Standard)</a>）：通过 JEP 110 标准化 JDK 9 中引入的孵化 HTTP 客户端 API，并在 JDK 10 中进行更新。<br>&emsp;&emsp;新版本的HTTP客户端（java.net.http包中） 除了实现了HTTP(1.1和2)、WebSocket，同步和异步调用以及Reactive Streams，还提供了清晰易懂的 Fluent 界面。代码如下所示：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同步请求</span></span><br><span class="line">var request = HttpRequest.newBuilder()</span><br><span class="line">    .uri(URI.create(<span class="string">"https://snowolf.gitee.io"</span>))</span><br><span class="line">    .GET()</span><br><span class="line">    .build();</span><br><span class="line">var client = HttpClient.newHttpClient();</span><br><span class="line">HttpResponse&lt;String&gt; response = client.send(request, HttpResponse.BodyHandlers.ofString());</span><br><span class="line">System.out.println(response.body());</span><br></pre></td></tr></table></figure><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//异步请求</span></span><br><span class="line">var request = HttpRequest.newBuilder()</span><br><span class="line">    .uri(URI.create(<span class="string">"https://snowolf.gitee.io"</span>))</span><br><span class="line">    .build();</span><br><span class="line">var client = HttpClient.newHttpClient();</span><br><span class="line">client.sendAsync(request, HttpResponse.BodyHandlers.ofString())</span><br><span class="line">    .thenApply(HttpResponse::body)</span><br><span class="line">    .thenAccept(System.out::println);</span><br></pre></td></tr></table></figure><h3 id="Unicode-10"><a href="#Unicode-10" class="headerlink" title="Unicode 10"></a>Unicode 10</h3><p>&emsp;&emsp;Unicode 10（<a href="http://openjdk.java.net/jeps/327" target="_blank" rel="noopener">JEP 327: Unicode 10</a>）：升级现有平台 API 以支持<a href="http://unicode.org/versions/Unicode10.0.0/" target="_blank" rel="noopener">Unicode v10.0 标准</a>。<br>&emsp;&emsp;Unicode 10.0 增加了8518 个字符, 总计达到了136,690个字符。并且增加了4个脚本, 总结139个脚本, 同时还有56个新的emoji表情符号。Java 11 主要升级了如下类库，来支持Unicode V10.0标准。</p><ul><li>java.lang包中的Character和String类</li><li>java.awt.font包中的NumericShaper类</li><li>java.text包中的Bidi、BreakIterator和Normalizerl类</li></ul><h3 id="移除-Java-EE-和-CORBA-模块"><a href="#移除-Java-EE-和-CORBA-模块" class="headerlink" title="移除 Java EE 和 CORBA 模块"></a>移除 Java EE 和 CORBA 模块</h3><p>&emsp;&emsp;移除 Java EE 和 CORBA 模块（<a href="http://openjdk.java.net/jeps/320" target="_blank" rel="noopener">JEP 320: Remove the Java EE and CORBA Modules</a>）：从Java SE Platform和JDK中删除Java EE和CORBA模块（JavaFX 也已被移除）。这些模块在Java SE 9中已弃用，声明的目的是为了在将来的版本中删除它们。<br>&emsp;&emsp;Java 11主要删除了如下包：</p><ul><li>java.xml.ws (JAX-WS以及与之相关的SAAJ和Web Services元数据)</li><li>java.xml.bind (JAXB)</li><li>java.activation (JAF)</li><li>java.xml.ws.annotation (Common Annotations)</li><li>java.corba (CORBA)</li><li>java.transaction (JTA)<br>同时移除了与之关联的模块，如下：</li></ul><ul><li>java.se.ee (上述六个包的聚合模块)</li><li>jdk.xml.ws (JAX-WS工具)</li><li>jdk.xml.bind (JAXB工具)<h3 id="弃用-Nashorn-JavaScript-引擎"><a href="#弃用-Nashorn-JavaScript-引擎" class="headerlink" title="弃用 Nashorn JavaScript 引擎"></a>弃用 Nashorn JavaScript 引擎</h3>&emsp;&emsp;弃用 Nashorn JavaScript 引擎（<a href="http://openjdk.java.net/jeps/335" target="_blank" rel="noopener">JEP 335: Deprecate the Nashorn JavaScript Engine</a>）：弃用 Nashorn JavaScript 脚本引擎和 API 以及 jjs 工具，意图在将来的版本中删除它们。<br>&emsp;&emsp;Java 11 将如下两个模块标记为了过期（<code>@Deprecated(forRemoval=true)</code>）:</li><li>jdk.scripting.nashorn（含jdk.nashorn.api.scripting和jdk.nashorn.api.tree两个包）</li><li>jdk.scripting.nashorn.shell（含jjsg工具，再执行jjs命令，将会出现过期的警告提示。）<h3 id="弃用-Pack200-工具和-API"><a href="#弃用-Pack200-工具和-API" class="headerlink" title="弃用 Pack200 工具和 API"></a>弃用 Pack200 工具和 API</h3>&emsp;&emsp;弃用 Pack200 工具和 API（<a href="http://openjdk.java.net/jeps/336" target="_blank" rel="noopener">JEP 336: Deprecate the Pack200 Tools and API</a>）：在 java.util.jar 中弃用 pack200 和 unpack200 工具以及 Pack200 API。<br>&emsp;&emsp;Pack200是当初Sun公司为更快地在网络上传输JAR文件而在JSR 200中提出的一种HTTP压缩方式。 从Sun JDK 1.50版就开始提供的Pack200压缩工具以及Pack200压缩文件。但随着技术的发展，开发人员已经不再需要使用这种压缩技术。主要理由如下：</li></ul><ol><li>JDK 9为Java运行时（JEP 220）和用于构建运行时（JMOD）的模块引入了新的压缩方案。因此，JDK 9及更高版本不依赖Pack200; JDK 8是在构建时使用pack200压缩的最后一个版本，在安装时未使用unpack200解压缩。JDK本身已不再需要Pack200技术。</li><li>客户端应用程序（Applet）的格局已发生变化，大多数浏览器都不再支持插件。Applet不再需要Pack200压缩技术。</li><li>Pack200是一项复杂而精细的技术。文件与类文件格式和JAR文件格式紧密耦合，然而JEP 309在类文件格式中添加了一种新的常量池条目，并且JEP 238将版本控制元数据添加到JAR文件格式。java.util.jar.Pack200中的API对Java SE平台的模块化是有害的，导致在Java SE 9中删除了它的四种方法。总的来说，维护Pack200的成本是巨大的，并且超过了它的好处。包括它在Java SE和JDK中。</li></ol><p>&emsp;&emsp;Java 11 将java.base模块中的如下三个类标记为过期（<code>@Deprecated(forRemoval=true)</code>）:</p><ul><li>java.util.jar.Pack200</li><li>java.util.jar.Pack200.Packer</li><li>java.util.jar.Pack200.Unpacker</li></ul><h2 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h2><h3 id="基于巢的访问控制"><a href="#基于巢的访问控制" class="headerlink" title="基于巢的访问控制"></a>基于巢的访问控制</h3><p>&emsp;&emsp;基于巢的访问控制（<a href="http://openjdk.java.net/jeps/181" target="_blank" rel="noopener">JEP 181:Nest-Based Access Control</a>）：即“Nestmate”。巢是一种访问控制上下文，与 Java 编程语言中现有的嵌套类型概念一致。 巢允许逻辑上属于同一代码实体，但被编译为不同类文件的类，无需编译器插入可访问性扩展桥接方法，即可访问彼此的私有成员。<br>&emsp;&emsp;Java 11 的巢访问控制引入了“巢（nest）”的概念，同一巢的两个成员（外部类和内部类）是同窝，它们具备同等的访问权限。这就改变了从Java 1.0开始的访问桥(access bridge) 的模式，改善了程序大小和额外性能损耗等问题，让应用程序和字节码更加简单、安全，并对开发者透明。</p><h3 id="动态类文件常量"><a href="#动态类文件常量" class="headerlink" title="动态类文件常量"></a>动态类文件常量</h3><p>&emsp;&emsp;动态类文件常量（<a href="http://openjdk.java.net/jeps/309" target="_blank" rel="noopener">JEP 309: Dynamic Class-File Constants</a>）：扩展 Java 类文件格式以支持新的常量池形式，CONSTANT_Dynamic。 加载　CONSTANT_Dynamic 会将创建委托给 bootstrap 方法，就像链接 invokedynamic 调用站点将链接委托给 bootstrap 方法一样。降低开发新形式的可实现类文件约束带来的成本和干扰。<br>&emsp;&emsp;</p><h3 id="改进-Aarch64-内联函数"><a href="#改进-Aarch64-内联函数" class="headerlink" title="改进 Aarch64 内联函数"></a>改进 Aarch64 内联函数</h3><p>&emsp;&emsp;改进 Aarch64 内联函数（<a href="http://openjdk.java.net/jeps/315" target="_blank" rel="noopener">JEP 315: Improve Aarch64 Intrinsics</a>）：改进现有的字符串和数组内联函数，并在 AArch64 处理器上为 java.lang.Math sin，cos 和 log 函数实现新的内联函数。专用的CPU架构的代码模式可提高用户应用程序和基准测试的性能。</p><h3 id="Epsilon-垃圾回收器"><a href="#Epsilon-垃圾回收器" class="headerlink" title="Epsilon 垃圾回收器"></a>Epsilon 垃圾回收器</h3><p>&emsp;&emsp;Epsilon 垃圾回收器（<a href="http://openjdk.java.net/jeps/318" target="_blank" rel="noopener">JEP 318: Epsilon: A No-Op Garbage Collector (Experimental)</a>）：又被称为”No-Op（无操作）”回收器,它仅负责内存分配，却没有实现任何实际的内存回收机制。 一旦可用的 Java 堆耗尽，JVM 将关闭。<br>&emsp;&emsp;Epsilon 垃圾回收器主要用来进行性能测试、内存压力测试等，Epsilon GC可以作为度量其他垃圾回收器性能的对照组。大神Martijn说，Epsilon GC至少能够帮助理解GC的接口，有助于成就一个更加模块化的JVM。</p><h3 id="运行记录仪"><a href="#运行记录仪" class="headerlink" title="运行记录仪"></a>运行记录仪</h3><p>&emsp;&emsp;运行记录仪（<a href="http://openjdk.java.net/jeps/328" target="_blank" rel="noopener">JEP 328: Flight Recorder</a>）：提供低开销的数据收集框架，用于对 Java 应用程序和 HotSpot JVM 进行故障排除。<br>&emsp;&emsp;JFR 是一套集成进入 JDK、JVM 内部的事件机制框架，通过良好架构和设计的框架，硬件层面的极致优化，生产环境的广泛验证，它可以做到极致的可靠和低开销。在<a href="https://www.spec.org/jbb2015/" target="_blank" rel="noopener">SPECjbb2015</a>等基准测试中，JFR 的性能开销最大不超过 1%，所以，工程师可以基本没有心理负担地在大规模分布式的生产系统使用，这意味着，我们既可以随时主动开启 JFR 进行特定诊断，也可以让系统长期运行 JFR，用以在复杂环境中进行“After-the-fact”分析。</p><h3 id="启动单文件源代码程序"><a href="#启动单文件源代码程序" class="headerlink" title="启动单文件源代码程序"></a>启动单文件源代码程序</h3><p>&emsp;&emsp;启动单文件源代码程序（<a href="http://openjdk.java.net/jeps/330" target="_blank" rel="noopener">JEP 330: Launch Single-File Source-Code Programs</a>）：增强 java 启动程序以运行作为 Java 源代码的单个文件提供的程序，包括通过“shebang”文件和相关技术从脚本中使用。<br>&emsp;&emsp;单文件程序是指整个程序只有一个源码文件，通常是早期学习Java阶段，或者写一个小型工具类。以HelloWorld.java为例，运行它之前需要先编译。我们希望Java启动器能直接运行这个源码级的程序：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java HelloWorld.java</span><br></pre></td></tr></table></figure><p></p><h3 id="低开销的堆分配采样方法"><a href="#低开销的堆分配采样方法" class="headerlink" title="低开销的堆分配采样方法"></a>低开销的堆分配采样方法</h3><p>&emsp;&emsp;低开销的堆分配采样方法（<a href="http://openjdk.java.net/jeps/331" target="_blank" rel="noopener">JEP 331: Low-Overhead Heap Profiling</a>）：提供一种低开销的 Java 堆分配采样方法，可通过 JVMTI 访问。<br>&emsp;&emsp;我们知道，高效地了解在 Java 堆上都进行了哪些对象分配，是诊断内存问题的基本出发点之一。 JEP 331 来源于 Google 等业界前沿厂商的一线实践，通过获取对象分配的 Call-site，为 JDK 补足了对象分配诊断方面的一些短板，工程师可以通过 JVMTI 使用这个能力增强自身的工具。</p><h3 id="ZGC：可扩展的低延迟垃圾收集器"><a href="#ZGC：可扩展的低延迟垃圾收集器" class="headerlink" title="ZGC：可扩展的低延迟垃圾收集器"></a>ZGC：可扩展的低延迟垃圾收集器</h3><p>&emsp;&emsp;ZGC：可扩展的低延迟垃圾收集器（<a href="http://openjdk.java.net/jeps/333" target="_blank" rel="noopener">JEP 333: ZGC: A Scalable Low-Latency Garbage Collector (Experimental)</a>）：Z垃圾收集器，也称为 ZGC，是一个可扩展的低延迟垃圾收集器。<br>&emsp;&emsp;从 JVM GC 的角度，JDK 11 引入了两种新的 GC，其中包括也许是划时代意义的 ZGC，虽然其目前还是实验特性，但是从能力上来看，这是 OpenJDK 的一个巨大突破，为特定生产环境的苛刻需求提供了一个可能的选择。例如，对部分企业核心存储等产品，如果能够保证不超过 10ms 的 GC 暂停，可靠性会上一个大的台阶，这是过去我们进行 GC 调优几乎做不到的，是能与不能的问题。</p><h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><h3 id="采用-Curve25519-和-Curve448-算法实现的密钥协议"><a href="#采用-Curve25519-和-Curve448-算法实现的密钥协议" class="headerlink" title="采用 Curve25519 和 Curve448 算法实现的密钥协议"></a>采用 Curve25519 和 Curve448 算法实现的密钥协议</h3><p>&emsp;&emsp;采用 Curve25519 和 Curve448 算法实现的密钥协议（<a href="http://openjdk.java.net/jeps/324" target="_blank" rel="noopener">JEP 324: Key Agreement with Curve25519 and Curve448</a>）：使用<a href="https://tools.ietf.org/html/rfc7748" target="_blank" rel="noopener">RFC 7748</a> 中描述的 Curve25519 和 Curve448 实现密钥协议。<br>&emsp;&emsp;密码学要求使用 Curve25519 和Curve448 是因为它们的安全性和性能。JDK会增加两个新的接口XECPublicKey 和 XECPrivateKey，示例代码如下：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">KeyPairGenerator kpg = KeyPairGenerator.getInstance(<span class="string">"XDH"</span>);</span><br><span class="line">NamedParameterSpec paramSpec = <span class="keyword">new</span> NamedParameterSpec(<span class="string">"X25519"</span>);</span><br><span class="line">kpg.initialize(paramSpec); <span class="comment">// equivalent to kpg.initialize(255)</span></span><br><span class="line"><span class="comment">// alternatively: kpg = KeyPairGenerator.getInstance("X25519")</span></span><br><span class="line">KeyPair kp = kpg.generateKeyPair();</span><br><span class="line"></span><br><span class="line">KeyFactory kf = KeyFactory.getInstance(<span class="string">"XDH"</span>);</span><br><span class="line">BigInteger u = ...</span><br><span class="line">XECPublicKeySpec pubSpec = <span class="keyword">new</span> XECPublicKeySpec(paramSpec, u);</span><br><span class="line">PublicKey pubKey = kf.generatePublic(pubSpec);</span><br><span class="line"></span><br><span class="line">KeyAgreement ka = KeyAgreement.getInstance(<span class="string">"XDH"</span>);</span><br><span class="line">ka.init(kp.getPrivate());</span><br><span class="line">ka.doPhase(pubKey, <span class="keyword">true</span>);</span><br><span class="line"><span class="keyword">byte</span>[] secret = ka.generateSecret();</span><br></pre></td></tr></table></figure><p></p><h3 id="实现-ChaCha20-和-Poly1305-加密算法"><a href="#实现-ChaCha20-和-Poly1305-加密算法" class="headerlink" title="实现 ChaCha20 和 Poly1305 加密算法"></a>实现 ChaCha20 和 Poly1305 加密算法</h3><p>&emsp;&emsp;实现 ChaCha20 和 Poly1305 加密算法（<a href="http://openjdk.java.net/jeps/329" target="_blank" rel="noopener">JEP 329: ChaCha20 and Poly1305 Cryptographic Algorithms</a>）：实现<a href="https://tools.ietf.org/html/rfc7539" target="_blank" rel="noopener">RFC 7539</a>中指定的 ChaCha20 和 ChaCha20-Poly1305 密码。ChaCha20 是一种相对较新的流密码，可以替代旧的、不安全的 RC4 流密码。<br>基于ChaCha20加密算法的示例代码：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get a Cipher instance and set up the parameters</span></span><br><span class="line"><span class="comment">// Assume SecretKey "key", 12-byte nonce "nonceBytes" and plaintext "pText"</span></span><br><span class="line"><span class="comment">// are coming from outside this code snippet</span></span><br><span class="line">Cipher mambo = Cipher.getInstance(<span class="string">"ChaCha20"</span>);</span><br><span class="line">ChaCha20ParameterSpec mamboSpec</span><br><span class="line">    = <span class="keyword">new</span> ChaCha20ParameterSpec(nonceBytes, <span class="number">7</span>);   <span class="comment">// Use a starting counter value of "7"</span></span><br><span class="line"><span class="comment">// Encrypt our input</span></span><br><span class="line">mambo.init(Cipher.ENCRYPT_MODE, key, mamboSpec);</span><br><span class="line"><span class="keyword">byte</span>[] encryptedResult = mambo.doFinal(pText);</span><br></pre></td></tr></table></figure><p></p><p>基于ChaCha20-Poly1305加密算法的示例代码：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get a Cipher instance and set up the parameters</span></span><br><span class="line"><span class="comment">// Assume SecretKey "key", 12-byte nonce "nonceBytes" and plaintext "pText"</span></span><br><span class="line"><span class="comment">// are coming from outside this code snippet</span></span><br><span class="line">Cipher mambo = Cipher.getInstance(<span class="string">"ChaCha20-Poly1305"</span>);</span><br><span class="line">AlgorithmParameterSpec mamboSpec = <span class="keyword">new</span> IvParameterSpec(nonceBytes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Encrypt our input</span></span><br><span class="line">mambo.init(Cipher.ENCRYPT_MODE, key, mamboSpec);</span><br><span class="line"><span class="keyword">byte</span>[] encryptedResult = <span class="keyword">new</span> <span class="keyword">byte</span>[mambo.getOutputSize(pText.length)];</span><br><span class="line">mambo.doFinal(pText, <span class="number">0</span>, pText.length, encryptedResult);</span><br></pre></td></tr></table></figure><p></p><h2 id="传输层安全性（TLS）1-3"><a href="#传输层安全性（TLS）1-3" class="headerlink" title="传输层安全性（TLS）1.3"></a>传输层安全性（TLS）1.3</h2><p>&emsp;&emsp;传输层安全性（TLS）1.3（<a href="http://openjdk.java.net/jeps/332" target="_blank" rel="noopener">JEP 332: Transport Layer Security (TLS) 1.3</a>）：实现传输层安全性（TLS）协议<a href="https://tools.ietf.org/html/rfc8446" target="_blank" rel="noopener">RFC 8446</a> 的 1.3 版。<br>&emsp;&emsp;TLS 1.3是TLS协议的重大改进，与以前的版本相比，它提供了显着的安全性和性能改进。其他供应商的几个早期实现已经可用。我们需要支持TLS 1.3以保持竞争力并与最新标准保持同步。这个特性的实现动机和Unicode 10一样，也是紧跟历史潮流。</p><p>&emsp;&emsp;以上就是Java 11的主要新特性，如果想详细了解这些新特性对开发带来的帮助和使用方法，请持续关注本系列博客。</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/2018/09/29/1/">Java 11 新特性预览</a></p><p><span>文章作者:</span><a href="/" title="访问 Snowolf Lee 的个人博客">Snowolf Lee</a></p><p><span>发布时间:</span>2018年09月29日 - 12:09</p><p><span>最后更新:</span>2018年09月29日 - 19:09</p><p><span>原始链接:</span><a href="/2018/09/29/1/" title="Java 11 新特性预览">https://snowolf.gitee.io/2018/09/29/1/</a><span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://snowolf.gitee.io/2018/09/29/1/" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div id="wechat_subscriber" style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center"> <img id="wechat_subscriber_qcode" src="/images/my-blog.png" alt="Snowolf Lee wechat" style="width:200px;max-width:100%"><div>欢迎您扫一扫上面的微信公众号，订阅我的博客！</div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/IT技术/" rel="tag"><i class="fa fa-tag"></i> IT技术</a><a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a><a href="/tags/新特性/" rel="tag"><i class="fa fa-tag"></i> 新特性</a></div></footer></div></article></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/sai.png" alt="Snowolf Lee"><p class="site-author-name" itemprop="name">Snowolf Lee</p><p class="site-description motion-element" itemprop="description">知行合一 笃行求是</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">1</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">2</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">3</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/sn0wolf" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:wu-wi01@163.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="http://wpa.qq.com/msgrd?v=3&uin=278738302&site=qq&menu=yes" target="_blank" title="QQ"><i class="fa fa-fw fa-qq"></i> QQ</a></span><span class="links-of-author-item"><a href="http://weibo.com/snow0lf" target="_blank" title="微博"><i class="fa fa-fw fa-weibo"></i> 微博</a></span><span class="links-of-author-item"><a href="https://www.douban.com/people/105358046/" target="_blank" title="豆瓣"><i class="fa fa-fw fa-globe"></i> 豆瓣</a></span><span class="links-of-author-item"><a href="http://www.zhihu.com/people/snowo1f" target="_blank" title="知乎"><i class="fa fa-fw fa-globe"></i> 知乎</a></span><span class="links-of-author-item"><a href="https://www.jianshu.com/u/6fc3b2c9102b" target="_blank" title="简书"><i class="fa fa-fw fa-globe"></i> 简书</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#语法"><span class="nav-number">1.</span> <span class="nav-text">语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Lambda-参数的本地变量语法"><span class="nav-number">1.1.</span> <span class="nav-text">Lambda 参数的本地变量语法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类库"><span class="nav-number">2.</span> <span class="nav-text">类库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-客户端（标准）"><span class="nav-number">2.1.</span> <span class="nav-text">HTTP 客户端（标准）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Unicode-10"><span class="nav-number">2.2.</span> <span class="nav-text">Unicode 10</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移除-Java-EE-和-CORBA-模块"><span class="nav-number">2.3.</span> <span class="nav-text">移除 Java EE 和 CORBA 模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#弃用-Nashorn-JavaScript-引擎"><span class="nav-number">2.4.</span> <span class="nav-text">弃用 Nashorn JavaScript 引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#弃用-Pack200-工具和-API"><span class="nav-number">2.5.</span> <span class="nav-text">弃用 Pack200 工具和 API</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#虚拟机"><span class="nav-number">3.</span> <span class="nav-text">虚拟机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基于巢的访问控制"><span class="nav-number">3.1.</span> <span class="nav-text">基于巢的访问控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#动态类文件常量"><span class="nav-number">3.2.</span> <span class="nav-text">动态类文件常量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#改进-Aarch64-内联函数"><span class="nav-number">3.3.</span> <span class="nav-text">改进 Aarch64 内联函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Epsilon-垃圾回收器"><span class="nav-number">3.4.</span> <span class="nav-text">Epsilon 垃圾回收器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行记录仪"><span class="nav-number">3.5.</span> <span class="nav-text">运行记录仪</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动单文件源代码程序"><span class="nav-number">3.6.</span> <span class="nav-text">启动单文件源代码程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#低开销的堆分配采样方法"><span class="nav-number">3.7.</span> <span class="nav-text">低开销的堆分配采样方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZGC：可扩展的低延迟垃圾收集器"><span class="nav-number">3.8.</span> <span class="nav-text">ZGC：可扩展的低延迟垃圾收集器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安全"><span class="nav-number">4.</span> <span class="nav-text">安全</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#采用-Curve25519-和-Curve448-算法实现的密钥协议"><span class="nav-number">4.1.</span> <span class="nav-text">采用 Curve25519 和 Curve448 算法实现的密钥协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现-ChaCha20-和-Poly1305-加密算法"><span class="nav-number">4.2.</span> <span class="nav-text">实现 ChaCha20 和 Poly1305 加密算法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#传输层安全性（TLS）1-3"><span class="nav-number">5.</span> <span class="nav-text">传输层安全性（TLS）1.3</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Snowolf Lee</span></div><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_uv">本站访客数:<span id="busuanzi_value_site_uv"></span></span></div><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共3.2k字</span></div><div class="weixin-box"><div class="weixin-menu"><div class="weixin-hover"><div class="weixin-description">微信扫一扫，订阅本博客</div></div></div></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=6.4.1"></script><script type="text/javascript" src="/js/src/motion.js?v=6.4.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=6.4.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.1"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">var GUEST=["nick","mail","link"],guest="nick,mail,link";guest=guest.split(",").filter(function(e){return-1<GUEST.indexOf(e)}),new Valine({el:"#comments",verify:!1,notify:!1,appId:"AcrDrefUNVwsjXVAjBVCHab9-gzGzoHsz",appKey:"geP0VJ24eaKXsQlCYq3uWX3M",placeholder:"Just go go",avatar:"mm",meta:guest,pageSize:"10",visitor:!1})</script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script>
    
    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function ({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
            Counter('put', `/classes/Counter/${counter.objectId}`, JSON.stringify({ time: { "__op":"Increment", "amount":1 } }))
            
            .done(function () {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.time + 1);
            })
            
            .fail(function ({ responseJSON }) {
                console.log('Failed to save Visitor num, with error message: ' + responseJSON.error);
            })
          } else {
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text('Counter not initialized! See more at console err msg.');
              console.error('ATTENTION! LeanCloud counter has security bug, see here how to solve it: https://github.com/theme-next/hexo-leancloud-counter-security. \n But you also can use LeanCloud without security, by set \'security\' option to \'false\'.');
            
          }
        })
      .fail(function ({ responseJSON }) {
        console.log('LeanCloud Counter Error:' + responseJSON.code + " " + responseJSON.error);
      });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + "AcrDrefUNVwsjXVAjBVCHab9-gzGzoHsz")
        .done(function ({ api_server }) {
          var Counter = function (method, url, data) {
            return $.ajax({
              method: method,
              url: `https://${api_server}/1.1${url}`,
              headers: {
                'X-LC-Id': "AcrDrefUNVwsjXVAjBVCHab9-gzGzoHsz",
                'X-LC-Key': "geP0VJ24eaKXsQlCYq3uWX3M",
                'Content-Type': 'application/json',
              },
              data: data,
            });
          };
          
          addCount(Counter);
          
        })
    });
  </script><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0309d2e3.js","daovoice"),daovoice("init",{app_id:"0309d2e3"}),daovoice("update")</script></body></html>